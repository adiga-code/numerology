# Numerology Bot

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÆ 4 —Ç–∞—Ä–∏—Ñ–∞: –ë—ã—Å—Ç—Ä—ã–π –≤–∑–≥–ª—è–¥, –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑, –ü–∞—Ä–Ω—ã–π –û—Ä–∞–∫—É–ª, –°–µ–º–µ–π–Ω—ã–π –û—Ä–∞–∫—É–ª
- ü§ñ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ (Manus API, GPT-4, Gemini)
- üí≥ –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –ÆKassa –∏ Telegram Stars
- üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á—ë—Ç–æ–≤
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –º–µ–∂–¥—É AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
- üí∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.11+
- aiogram 3.x (Telegram Bot)
- FastAPI (Webhooks)
- PostgreSQL (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- Redis (FSM storage, –∫–µ—à)
- SQLAlchemy 2.0 (ORM)
- Alembic (–ú–∏–≥—Ä–∞—Ü–∏–∏)
- Docker + Docker Compose

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd numerology
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª, –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫–ª—é—á–∏:

```env
BOT_TOKEN=your_telegram_bot_token
MANUS_API_KEY=your_manus_api_key
OPENAI_API_KEY=your_openai_api_key
GEMINI_API_KEY=your_gemini_api_key
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key
DATABASE_URL=postgresql+asyncpg://numerology:numerology@db:5432/numerology
REDIS_URL=redis://redis:6379/0
WEBHOOK_DOMAIN=https://your-domain.com
```

### 3. –ó–∞–ø—É—Å–∫ —Å Docker

```bash
docker-compose up --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ:
- Bot: Telegram
- API: http://localhost:8000
- Health check: http://localhost:8000/health

### 4. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ PostgreSQL –∏ Redis
docker-compose up db redis

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
python src/main.py
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
numerology/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ bot.py               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ api.py               # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/            # –ú–æ–¥–µ–ª–∏ –∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ FSM
‚îÇ   ‚îú‚îÄ‚îÄ services/            # AI —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ webhooks/            # Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã, enums, states
‚îú‚îÄ‚îÄ alembic/                 # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ templates/               # –®–∞–±–ª–æ–Ω—ã –¥–ª—è PDF
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ requirements.txt
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- `/new` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
- `/history` - –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
- `/help` - –°–ø—Ä–∞–≤–∫–∞
- `/support` - –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- `/cancel` - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑

## –¢–∞—Ä–∏—Ñ—ã

| –¢–∞—Ä–∏—Ñ | –û–ø–∏—Å–∞–Ω–∏–µ | –¶–µ–Ω–∞ | –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
|-------|----------|------|------------|
| –ë—ã—Å—Ç—Ä—ã–π –≤–∑–≥–ª—è–¥ | –ö—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑, 5-7 —Å—Ç—Ä | 500‚ÇΩ | 1 |
| –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ | –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑, 15-20 —Å—Ç—Ä | 1500‚ÇΩ | 1 |
| –ü–∞—Ä–Ω—ã–π –û—Ä–∞–∫—É–ª | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–∞—Ä—ã, 15-25 —Å—Ç—Ä | 2000‚ÇΩ | 2 |
| –°–µ–º–µ–π–Ω—ã–π –û—Ä–∞–∫—É–ª | –°–µ–º–µ–π–Ω—ã–π –∞–Ω–∞–ª–∏–∑, 30-50 —Å—Ç—Ä | 3000‚ÇΩ | 3-5 |

## API Endpoints

### Health Check
```
GET /health
```

### Webhooks
```
POST /webhook/manus      # Manus AI webhook
POST /webhook/yookassa   # –ÆKassa webhook
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ú–∏–≥—Ä–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ Alembic:

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "description"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+
- PostgreSQL 15+
- Redis 7+

### –ö–æ–¥ —Å—Ç–∞–π–ª
- –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∏ docstrings
- Type hints –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
- Async/await –¥–ª—è –≤—Å–µ—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
