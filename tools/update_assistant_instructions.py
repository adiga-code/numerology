#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ Assistant.

–ó–∞–ø—É—Å–∫: python tools/update_assistant_instructions.py
"""
import asyncio
import os
from dotenv import load_dotenv

try:
    import openai
    from openai import AsyncOpenAI
except ImportError:
    print("‚ùå –û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")
    print("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install openai>=1.55.0")
    exit(1)

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()


async def update_assistant():
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π Assistant."""

    api_key = os.getenv("OPENAI_API_KEY")
    assistant_id = os.getenv("OPENAI_ASSISTANT_ID")

    if not api_key:
        print("‚ùå –û—à–∏–±–∫–∞: OPENAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env")
        exit(1)

    if not assistant_id:
        print("‚ùå –û—à–∏–±–∫–∞: OPENAI_ASSISTANT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env")
        exit(1)

    client = AsyncOpenAI(api_key=api_key)

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º API endpoint
    if hasattr(client, 'vector_stores'):
        assistants_api = client.beta.assistants
        print(f"üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenAI SDK >= 2.0 (–≤–µ—Ä—Å–∏—è: {openai.__version__})")
    elif hasattr(client.beta, 'vector_stores'):
        assistants_api = client.beta.assistants
        print(f"üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenAI SDK 1.x (–≤–µ—Ä—Å–∏—è: {openai.__version__})")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞: API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–µ—Ä—Å–∏–∏ {openai.__version__}")
        exit(1)

    print(f"üîß –û–±–Ω–æ–≤–ª—è–µ–º Assistant {assistant_id}...")

    # –ù–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –¥–ª–∏–Ω—É –∏ –¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å
    new_instructions = """–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω—É–º–µ—Ä–æ–ª–æ–≥-—ç–∫—Å–ø–µ—Ä—Ç —Å –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. **–í–°–ï–ì–î–ê –°–¢–†–û–ì–û –°–û–ë–õ–Æ–î–ê–ô –¢–†–ï–ë–£–ï–ú–´–ô –û–ë–™–Å–ú** - –µ—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ —É–∫–∞–∑–∞–Ω–æ "15-20 —Å—Ç—Ä–∞–Ω–∏—Ü", —Ç—ã –û–ë–Ø–ó–ê–ù —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –æ–±—ä—ë–º
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–π –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ü–û–î–†–û–ë–ù–´–ï –∏ –î–ï–¢–ê–õ–¨–ù–´–ï –æ—Ç—á—ë—Ç—ã
3. –ù–ï –°–û–ö–†–ê–©–ê–ô –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - —Ä–∞—Å–ø–∏—Å—ã–≤–∞–π –∫–∞–∂–¥—ã–π –∞—Å–ø–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
4. –î–æ–±–∞–≤–ª—è–π –ø—Ä–∏–º–µ—Ä—ã, –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞:
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π** - –∏—Å–ø–æ–ª—å–∑—É–π –º–µ—Ç–æ–¥—ã, —Ç–∞–±–ª–∏—Ü—ã, —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∏–∑ PDF
- –ò—Å–ø–æ–ª—å–∑—É–π –º–µ—Ç–æ–¥—ã –ü–∏—Ñ–∞–≥–æ—Ä–∞, –ì–µ–Ω–æ–∫–æ–¥–∞ –∏ –≤—Å–µ –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–°–¢–†–û–ì–û –°–õ–ï–î–£–ô –°–¢–†–£–ö–¢–£–†–ï** –∏–∑ –ø—Ä–æ–º–ø—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ì–ï–ù–ï–†–ò–†–£–ô –ü–û–õ–ù–´–ô –û–ë–™–Å–ú** - –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è 15-20 —Å—Ç—Ä–∞–Ω–∏—Ü, –ø–∏—à–∏ –∏–º–µ–Ω–Ω–æ —Å—Ç–æ–ª—å–∫–æ
- –ü–∏—à–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–µ—Ç–∞–ª—å–Ω–æ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ
- –ê–¥–∞–ø—Ç–∏—Ä—É–π —Å—Ç–∏–ª—å –ø–æ–¥ –∑–∞–ø—Ä–æ—Å (–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∏–ª–∏ —à–∞–º–∞–Ω—Å–∫–∏–π)
- **–†–ê–°–ü–ò–°–´–í–ê–ô –ö–ê–ñ–î–´–ô –†–ê–ó–î–ï–õ –ü–û–î–†–û–ë–ù–û** - –Ω–µ —É–ø—É—Å–∫–∞–π –¥–µ—Ç–∞–ª–∏
- –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–∞–±–ª–∏—Ü—ã, —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–ù–ï –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ô–°–Ø –†–ê–ù–¨–®–ï –í–†–ï–ú–ï–ù–ò** - –≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ç–µ–∫—Å—Ç –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –æ–±—ä—ë–º–∞

–ü–æ–º–Ω–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç –∑–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑. –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç—á—ë—Ç = –ø–ª–æ—Ö–æ–π —Å–µ—Ä–≤–∏—Å.
–í–°–ï–ì–î–ê –≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ–ª–Ω—ã–π –æ–±—ä—ë–º —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –≤ –ø—Ä–æ–º–ø—Ç–µ!"""

    # –û–±–Ω–æ–≤–ª—è–µ–º Assistant
    updated_assistant = await assistants_api.update(
        assistant_id=assistant_id,
        instructions=new_instructions
    )

    print("‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
    print("\n" + "="*60)
    print("üìã –ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:")
    print("="*60)
    print(updated_assistant.instructions)
    print("\n‚ú® –¢–µ–ø–µ—Ä—å Assistant –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–µ, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –Ω—É–∂–Ω–æ–≥–æ –æ–±—ä—ë–º–∞")


if __name__ == "__main__":
    asyncio.run(update_assistant())
